<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" type="text/css" href="../CSS/homePageStyle.css">
<link rel="stylesheet" type="text/css" href="../CSS/dataTable.css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/qtip2/3.0.3/jquery.qtip.min.css">
<title>Dashboard</title>
</head>
<body>

<div class="header">
    <div class="title">
    <h1>Dashboard</h1>
    <p>Welcome, <span id="userFullName"></span></p>
    </div>
    <div class="logout">
    <button type="submit" onclick="window.location.href='../PHP_controller/logoutController.php';">Log Out</button>    
    </div>
</div>

<script>
var userFirstName = "<?php echo $userFirstName; ?>";
var userLastName = "<?php echo $userLastName; ?>";
var role = "<?php echo $role; ?>";
var price = "<?php echo $price; ?>";

var userFullName = userFirstName + " " + userLastName + " (" + role + ")";
document.addEventListener("DOMContentLoaded", function() {
    document.getElementById("userFullName").textContent = userFullName;
    adjustContentBasedOnRole(role);
});

function adjustContentBasedOnRole(role) {
    var restrictedContent = "Accessible uniquement pour les Project Manager et les Project Owner";
    var restrictedDivs = ['form', 'financial', 'validate'];

    if (role === 'Developer' || role === 'Intern' || role === 'New') {
        restrictedDivs.forEach(function(divId) {
            var div = document.getElementById(divId);
            if (div) {
                div.innerHTML = "<h2>" + div.querySelector('h2').textContent + "</h2><p>" + restrictedContent + "</p>";
            }
        });
    }
}
</script>

<div class="container" id="planning">
    <h2>Planning</h2>
    <div id="calendar"></div>
</div>

<div id="structure">
<div class="container" id="form">
    <h2>Ajouter une tâche</h2>
    <form action="../PHP_controller/homepageController.php" method="post">
        <label for="nom">Nom :</label>
        <input type="text" id="nom" name="nom" required><br><br>

        <label for="type">Type :</label>
        <select id="type" name="type" required>
            <option value="">Selectionnez une valeur</option>
            <option value="1">Graphisme</option>
            <option value="2">Documentation</option>
            <option value="3">Requirements</option>
            <option value="4">Developement</option>
        </select><br><br>

        <label for="Assignee">Assigner à:</label>
        <select id="Assignee" name="Assignee">
        </select><br><br>

        <label for="pastel1">Couleur :</label> <br>
        <div class="colorSelector">
            <div>
                <input type="radio" id="pastel1" name="couleur" value="0" required>
                <label for="pastel1" style="background-color: #fde2e4; padding: 10px; border: 1px solid #000;">Pivoine</label><br>
            </div>
            <div>
                <input type="radio" id="pastel2" name="couleur" value="1" required>
                <label for="pastel2" style="background-color: #accbe1; padding: 10px; border: 1px solid #000;">Myosotis</label><br>
            </div>
            <div>
                <input type="radio" id="pastel3" name="couleur" value="2" required>
                <label for="pastel3" style="background-color: #9fd8df; padding: 10px; border: 1px solid #000;">Hortensia</label><br>
            </div>
            <div>
                <input type="radio" id="pastel4" name="couleur" value="3" required>
                <label for="pastel4" style="background-color: #97c1a9; padding: 10px; border: 1px solid #000;">Eucalyptus</label><br>
            </div>
            <div>
                <input type="radio" id="pastel5" name="couleur" value="4" required>
                <label for="pastel5" style="background-color: #e4cbf8; padding: 10px; border: 1px solid #000;">Lotus</label><br><br>
            </div>
        </div>

        <label for="dateDebut">Date de début :</label>
        <input type="date" id="dateDebut" name="dateDebut" required><br><br>

        <label for="dateFin">Date de fin :</label>
        <input type="date" id="dateFin" name="dateFin" required><br><br>

        <label for="tempsEstime">Temps estimé (en heures) :</label>
        <input type="number" id="tempsEstime" name="tempsEstime" min="0" step="0.5" required><br><br>

        <button type="submit" name="submitTaskForm">Ajouter une tâche</button>
    </form>
</div>

<section class="container" id="TaskViewer">
    <h2>Tâches</h2>
    <div class="TableGrid">
        <div class="Table">
            <table id="T1">
                <thead>
                    <tr>
                        <th>Nom</th>
                        <th>Type</th>
                        <th>État</th>
                        <th>Date de début</th>
                        <th>Date de fin</th>
                        <th>Temps estimé</th>
                        <th>Assignée à</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
        <div class="AddColumn" style="display: none;"> +</div>
        <div class="AddRow" style="display: none;"> + </div>
    </div>
</section>
</div>

<div class="container" id="financial">
    <h2>Prévisionnel budgétaire</h2>
    <div class="financialTable">
    <div class="budget">
        <h2>Actuel</h2>
        <table>
            <tr>
                <th>Tâches actuelles</th>
                <td id="actualTask">12</td>
            </tr>
            <tr>
                <th>Coût total</th>
                <td id="totalCost">8000€</td>
            </tr>
            <tr>
                <th>Nombre heures totales</th>
                <td id="totalHours">8h</td>
            </tr>
            <tr>
                <th>Coût horaire</th>
                <td id="hourlyCost">1000€</td>
            </tr>
            <tr>
                <th>Personnes actuelles</th>
                <td id="actualUsers"></td>
            </tr>
        </table>
    </div>
    <div class="budget">
        <h2>Futur</h2>
        <table>
            <tr>
                <th>Tâches planifiées</th>
                <td id="plannedTask">12</td>
            </tr>
            <tr>
                <th>Coût total</th>
                <td id="plannedTaskCost">8000€</td>
            </tr>
            <tr>
                <th>Nombre d'heures planifiées</th>
                <td id="plannedHours">8h</td>
            </tr>
            <tr>
                <th>Coût horaire</th>
                <td id="plannedHourlyCost">8000€</td>
            </tr>
            <tr>
                <th>Personnes futures</th>
                <td id="futureUsers"></td>
            </tr>
        </table>
      </div>
    </div>
    <div class="budget">
      <table>
        <tr>
            <th>Coût total projet</th>
            <td id="totalProjectCost">8000€</td>
        </tr>
      </table>
    </div>
</div>

<div class="structureNext">
  <div class="container" id="validate">
      <h2>Modifier l'état de la tâche</h2>
      <form>
          <div class="form-group">
              <label for="tache-selection">Sélectionner la tâche</label>
              <select id="tache-selection" name="tache-selection">
              </select>
          </div>
          <div class="form-group">
              <label for="etat">État de la tâche</label>
              <input type="text" id="etat" name="etat" value="Validated" readonly>
          </div>
          <div class="validate-button">
              <button type="button" id="state-button" class="btn">Valider</button>
              <button type="button" id="state-button2" class="btn" style="display: none;">Valider</button>
          </div>
      </form>
  </div>

  <div class="container" id="history">
      <h2>Historique des tâches</h2>
      <div class="form-group">
          <label for="tache-selection">Tâches</label>
          <select id="tache-selection-2">
          </select>
      </div>
      <div class="task-details">
          <h3>Détails de la Tâche</h3>
          <p><strong>Nom :</strong> <input type="text" id="task-name" readonly></p>
          <p><strong>Type :</strong> <input type="text" id="task-id_type" readonly></p>
          <p><strong>État :</strong> <input type="text" id="task-id_state" readonly></p>
          <p><strong>Validée :</strong> <input type="text" id="task-is_validated" readonly></p>
          <p><strong>Couleur :</strong> <input type="text" id="task-color" readonly></p>
          <p><strong>Date de début :</strong> <input type="text" id="task-date_debut" readonly></p>
          <p><strong>Date de fin :</strong> <input type="text" id="task-date_fin" readonly></p>
          <p><strong>Temps estimé :</strong> <input type="text" id="task-estimated_time" readonly></p>
          <p><strong>Créée le :</strong> <input type="text" id="task-created_at" readonly></p>
      </div>
  </div>
</div>

<footer class="footer">
    <div class="waves">
    <div class="wave" id="wave1"></div>
    <div class="wave" id="wave2"></div>
    <div class="wave" id="wave3"></div>
    <div class="wave" id="wave4"></div>
    </div>
    <p>&copy;2024 Barut Benhamou Brana | All Rights Reserved for ESTIA - Project TAI Limited&copy;</p>
</footer>
<script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
<!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<!-- Moment.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
<!-- FullCalendar -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.js"></script>
<!-- qTip -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qtip2/3.0.3/jquery.qtip.min.js"></script>
<script src="../JS_controller/TableManager.js"></script>
<script>
    var tasksJsonString = '<?php echo addslashes($tasks_json); ?>';
    var assigneesJsonString = '<?php echo addslashes($assignees_json); ?>';
    var rolesJsonString = '<?php echo addslashes($roles_json); ?>';
    var assignedJsonString = '<?php echo addslashes($assigned_json); ?>';
</script>
<script src="../JS_controller/script.js"></script>
</body>
</html>
